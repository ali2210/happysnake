{"ast":null,"code":"import _classCallCheck from \"/home/ali/Documents/run_prj/happysnake/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/ali/Documents/run_prj/happysnake/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/ali/Documents/run_prj/happysnake/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/ali/Documents/run_prj/happysnake/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/ali/Documents/run_prj/happysnake/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/home/ali/Documents/run_prj/happysnake/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\n// Cipher Block Chaining\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _CBC_iv, _CBC_lastBlock;\nimport { ModeOfOperation } from \"./mode.js\";\nexport var CBC = /*#__PURE__*/function (_ModeOfOperation) {\n  _inherits(CBC, _ModeOfOperation);\n  function CBC(key, iv) {\n    var _this;\n    _classCallCheck(this, CBC);\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CBC).call(this, \"ECC\", key, CBC));\n    _CBC_iv.set(_assertThisInitialized(_assertThisInitialized(_this)), void 0);\n    _CBC_lastBlock.set(_assertThisInitialized(_assertThisInitialized(_this)), void 0);\n    if (iv) {\n      if (iv.length % 16) {\n        throw new TypeError(\"invalid iv size (must be 16 bytes)\");\n      }\n      __classPrivateFieldSet(_assertThisInitialized(_assertThisInitialized(_this)), _CBC_iv, new Uint8Array(iv), \"f\");\n    } else {\n      __classPrivateFieldSet(_assertThisInitialized(_assertThisInitialized(_this)), _CBC_iv, new Uint8Array(16), \"f\");\n    }\n    __classPrivateFieldSet(_assertThisInitialized(_assertThisInitialized(_this)), _CBC_lastBlock, _this.iv, \"f\");\n    return _this;\n  }\n  _createClass(CBC, [{\n    key: \"encrypt\",\n    value: function encrypt(plaintext) {\n      if (plaintext.length % 16) {\n        throw new TypeError(\"invalid plaintext size (must be multiple of 16 bytes)\");\n      }\n      var ciphertext = new Uint8Array(plaintext.length);\n      for (var i = 0; i < plaintext.length; i += 16) {\n        for (var j = 0; j < 16; j++) {\n          __classPrivateFieldGet(this, _CBC_lastBlock, \"f\")[j] ^= plaintext[i + j];\n        }\n        __classPrivateFieldSet(this, _CBC_lastBlock, this.aes.encrypt(__classPrivateFieldGet(this, _CBC_lastBlock, \"f\")), \"f\");\n        ciphertext.set(__classPrivateFieldGet(this, _CBC_lastBlock, \"f\"), i);\n      }\n      return ciphertext;\n    }\n  }, {\n    key: \"decrypt\",\n    value: function decrypt(ciphertext) {\n      if (ciphertext.length % 16) {\n        throw new TypeError(\"invalid ciphertext size (must be multiple of 16 bytes)\");\n      }\n      var plaintext = new Uint8Array(ciphertext.length);\n      for (var i = 0; i < ciphertext.length; i += 16) {\n        var block = this.aes.decrypt(ciphertext.subarray(i, i + 16));\n        for (var j = 0; j < 16; j++) {\n          plaintext[i + j] = block[j] ^ __classPrivateFieldGet(this, _CBC_lastBlock, \"f\")[j];\n          __classPrivateFieldGet(this, _CBC_lastBlock, \"f\")[j] = ciphertext[i + j];\n        }\n      }\n      return plaintext;\n    }\n  }, {\n    key: \"iv\",\n    get: function get() {\n      return new Uint8Array(__classPrivateFieldGet(this, _CBC_iv, \"f\"));\n    }\n  }]);\n  return CBC;\n}(ModeOfOperation);\n_CBC_iv = new WeakMap(), _CBC_lastBlock = new WeakMap();","map":null,"metadata":{},"sourceType":"module"}